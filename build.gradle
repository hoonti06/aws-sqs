plugins {
    id 'java'
    id 'org.springframework.boot' version "${awsVersion}"
    id 'io.spring.dependency-management' version '1.0.15.RELEASE'
    id 'com.avast.gradle.docker-compose' version '0.15.2'
}

group = 'me.hoonti06'
version = '0.0.1-SNAPSHOT'
sourceCompatibility = 11

apply plugin: 'docker-compose'

allprojects {
    repositories {
        mavenCentral()
    }
}

subprojects {
    apply plugin: 'java'
    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'

    dependencies {
        implementation 'org.springframework.boot:spring-boot-starter-web'
        implementation "org.springframework.cloud:spring-cloud-aws-messaging:${awsVersion}"
        implementation "org.springframework.cloud:spring-cloud-aws-autoconfigure:${awsVersion}"

        compileOnly 'org.projectlombok:lombok'
        testCompileOnly 'org.projectlombok:lombok'
        annotationProcessor 'org.springframework.boot:spring-boot-configuration-processor'
        annotationProcessor 'org.projectlombok:lombok'
        testAnnotationProcessor 'org.projectlombok:lombok'
        testImplementation('org.springframework.boot:spring-boot-starter-test') {
            exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
        }
        testImplementation "cloud.localstack:localstack-utils:${localstackUtilsVersion}"
        testImplementation "org.testcontainers:testcontainers:${testcontainersVersion}"
        testImplementation "org.testcontainers:localstack:${testcontainersVersion}"
        testImplementation "org.testcontainers:junit-jupiter:${testcontainersVersion}"
        testImplementation "org.springframework.cloud:spring-cloud-aws-messaging:${awsVersion}"
        testImplementation "org.springframework.cloud:spring-cloud-aws-autoconfigure:${awsVersion}"
        testImplementation 'io.awspring.cloud:spring-cloud-aws-test:2.4.4'
    }

}

tasks.named('test') {
    useJUnitPlatform()
}

dockerCompose {
    useComposeFiles = ['./docker-compose.yml']
}